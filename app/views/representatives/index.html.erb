<%= render "actions", title: "Listagem de Representantes" %>

<div class="flex flex-col px-5">
  <div class="overflow-x-auto">
    <table class="table-auto w-full text-sm font-semibold text-center">
      <thead class="text-base">
        <tr>
          <th>ID</th>
          <th>Representante</th>
          <th>Número</th>
          <th>Filial</th>
          <th>Parceria</th>
          <th>Ações</th>
          <th></th>
        </tr>
      </thead>

      <tbody>
        <% @representatives.each_with_index do |representative, index| %>
          <tr class="border-t border-black items-center <%= index % 2 == 0 ? "bg-gray-200" : "bg-gray-100" %>">
            <td><%= representative.id %></td>
            <td><%= representative.name %></td>
            <td><%= representative.branch.branch_number.to_s.rjust(3, '0') %></td>
            <td><%= representative.branch.name %></td>
            <td><%= formatted_percentage(representative.partnership) %></td>

            <td class="flex justify-center items-center gap-2 h-10">
              <button type="button" onclick="document.getElementById('edit_representative<%= representative.id %>').showModal();" title="Editar">
                <span class="material-symbols-outlined text-primary">edit</span>
              </button>

              <dialog id="edit_representative<%= representative.id %>" class="modal place-items-center">
                <%= render ModalComponent.new(form: render("form", representative: representative, branches: @branches, title: "Editar Representante : #{representative.id}", btn_save: "Atualizar")) %>
              </dialog>

              <%= link_to_if representative.performs_closing?,
                  "<span class='material-symbols-outlined text-primary'>description</span>".html_safe,
                  monthly_report_representative_path(representative), title: "Resumo"
              %>

              <%= link_to_if representative.performs_closing?,
                  "<span class='material-symbols-outlined text-primary'>list_alt</span>".html_safe,
                  patient_listing_representative_path(representative), title: "Listagem"
              %>

              <%= link_to_if representative.performs_closing?,
                  "<span class='material-symbols-outlined text-primary'>content_paste</span>".html_safe,
                  summary_patient_listing_representative_path(representative), title: "Listagem Resumida"
              %>

              <%= link_to_if representative.performs_closing?,
                  "<span class='material-symbols-outlined text-primary'>home</span>".html_safe,
                  unaccumulated_addresses_representative_path(representative), title: "Endereço"
              %>

              <button type="button" onclick="document.getElementById('account_balance_representative<%= representative.id %>').showModal();" title="Adicionar nova Conta Corrente">
                <span class="material-symbols-outlined text-primary">account_balance</span>
              </button>

              <dialog id="account_balance_representative<%= representative.id %>" class="modal place-items-center">
                <%= render ModalComponent.new(form: render("current_accounts/form", representative: representative, current_account: @current_account, representatives: @representatives, title: "Criar Nova Conta Corrente", btn_save: "Salvar", route: "representative")) %>
              </dialog>

              <%= render ActiveInactiveLinkComponent.new(representative: representative, route: "representative", url: change_active_representative_path(representative)) %>
            </td>

            <td class="cursor-pointer" data-controller="toggle" data-action="click->toggle#tableTr" data-tr-id="representative_tr_hidden_<%= index %>">
              <details class="collapse collapse-arrow -top-3 h-10">
                <summary class="collapse-title font-semibold"></summary>
              </details>
            </td>
          </tr>

          <tr class="hidden bg-white" id="representative_tr_hidden_<%= index %>">
            <%= render "current_accounts", representative: representative, representatives: @representatives, index: index %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <%= render PaginationComponent.new(pagy: pagy_nav(@pagy), pages: @pagy.pages) %>
</div>
