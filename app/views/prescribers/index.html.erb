<div class="flex justify-between prescribers-center my-5 mb-10">
  <h1 class="text-2xl text-center text-primary mx-auto">Listagem de Prescritores</h1>
</div>

<div class="flex flex-col px-5">
  <div class="overflow-x-auto">
    <table class="table-auto w-full text-sm font-semibold text-center">
      <thead class="text-base">
        <tr>
          <th>ID</th>
          <th>Nome</th>
          <th>Representante</th>
          <th>Conselho</th>
          <th>Ações</th>
        </tr>
      </thead>

      <tbody>
        <% @prescribers.each_with_index do |prescriber, index| %>
          <tr class="border-t border-black <%= index % 2 == 0 ? "bg-gray-200" : "bg-gray-100" %> h-10">
            <td><%= prescriber.id %></td>

            <td>
              <%= link_to prescriber.name, prescriber_path(prescriber), class: "text-primary" %>
            </td>

            <td><%= prescriber&.representative&.name %></td>
            <td><%= prescriber.full_concil %></td>

            <td class="flex justify-center items-center gap-2">
              <%= link_to patient_listing_prescriber_path(prescriber),
                  title: "Listagem de Pacientes" do %>
                <span class="material-symbols-outlined text-primary">personal_injury</span>
              <% end %>

              <% if @requests[prescriber.id].present? %>
                <button onclick="document.getElementById('requests_prescriber<%= prescriber.id %>').showModal();" title="Requisições">
                  <span class="material-symbols-outlined text-primary">repeat</span>
                </button>

                <dialog id="requests_prescriber<%= prescriber.id %>" class="modal place-items-center">
                  <%= render ModalComponent.new(form: render("form_requests", prescriber: prescriber, requests: @requests[prescriber.id], title: "Requisições", btn_save: "Salvar")) %>
                </dialog>
              <% else %>
                <span class="material-symbols-outlined text-black" title="Requisições">repeat</span>
              <% end %>

              <button onclick="document.getElementById('edit_prescriber<%= prescriber.id %>').showModal();" title="Editar">
                <span class="material-symbols-outlined text-primary">edit</span>
              </button>

              <dialog id="edit_prescriber<%= prescriber.id %>" class="modal place-items-center">
                <%= render ModalComponent.new(form: render("form", prescriber: prescriber, representatives: @representatives, title: "Editar Prescritor : #{prescriber.id}", btn_save: "Atualizar")) %>
              </dialog>

              <%= link_to prescriber_path(prescriber),
                  data: { turbo_confirm: "Tem certeza que deseja apagar o prescritor? #{prescriber.name}", turbo_method: :delete },
                  title: "Apagar definitivamente" do %>
                <span class="material-symbols-outlined text-primary">delete</span>
              <% end %>

              <%= link_to change_accumulated_prescriber_path(prescriber, accumulated: true), data: { turbo_method: :post }, title: "Desacumular este mês" do %>
                <span class="material-symbols-outlined text-primary">close</span>
              <% end %>

              <%= link_to change_accumulated_prescriber_path(prescriber, accumulated: false), data: { turbo_method: :post }, title: "Acumular este mês" do %>
                <span class="material-symbols-outlined text-primary">add</span>
              <% end %>

              <button onclick="document.getElementById('account_balance_prescriber<%= prescriber.id %>').showModal();" title="Adicionar nova Conta Corrente">
                <span class="material-symbols-outlined text-primary">account_balance</span>
              </button>

              <dialog id="account_balance_prescriber<%= prescriber.id %>" class="modal place-items-center">
                <%#= render ModalComponent.new(form: render("current_accounts/form", representative: prescriber, current_account: @current_account, representatives: @prescribers_map, title: "Criar Nova Conta Corrente", btn_save: "Salvar", route: "prescriber")) %>
              </dialog>

              <button onclick="document.getElementById('discount_prescriber<%= prescriber.id %>').showModal();" title="Novo Desconto">
                <span class="material-symbols-outlined text-primary">percent</span>
              </button>

              <dialog id="discount_prescriber<%= prescriber.id %>" class="modal place-items-center">
                <%= render ModalComponent.new(form: render("discounts/form", discount: @discount, branches: @branches, prescriber: prescriber, title: "Novo Desconto", btn_save: "Salvar", route: "prescribers")) %>
              </dialog>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <%= render PaginationComponent.new(pagy: pagy_nav(@pagy), pages: @pagy.pages) %>
</div>
